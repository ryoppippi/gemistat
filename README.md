# gemistat

> **gemi**ni + **stat**istics â€” Comprehensive Gemini CLI usage analytics that track your token consumption and costs with precision!

> âš ï¸ **Under Development**: This project is currently in active development. Features and APIs may change. Please report any issues or feedback!

<p align="center">
    <a href="https://deepwiki.com/ryoppippi/gemistat"><img src="https://img.shields.io/badge/DeepWiki-ryoppippi%2Fgemistat-blue.svg?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAyCAYAAAAnWDnqAAAAAXNSR0IArs4c6QAAA05JREFUaEPtmUtyEzEQhtWTQyQLHNak2AB7ZnyXZMEjXMGeK/AIi+QuHrMnbChYY7MIh8g01fJoopFb0uhhEqqcbWTp06/uv1saEDv4O3n3dV60RfP947Mm9/SQc0ICFQgzfc4CYZoTPAswgSJCCUJUnAAoRHOAUOcATwbmVLWdGoH//PB8mnKqScAhsD0kYP3j/Yt5LPQe2KvcXmGvRHcDnpxfL2zOYJ1mFwrryWTz0advv1Ut4CJgf5uhDuDj5eUcAUoahrdY/56ebRWeraTjMt/00Sh3UDtjgHtQNHwcRGOC98BJEAEymycmYcWwOprTgcB6VZ5JK5TAJ+fXGLBm3FDAmn6oPPjR4rKCAoJCal2eAiQp2x0vxTPB3ALO2CRkwmDy5WohzBDwSEFKRwPbknEggCPB/imwrycgxX2NzoMCHhPkDwqYMr9tRcP5qNrMZHkVnOjRMWwLCcr8ohBVb1OMjxLwGCvjTikrsBOiA6fNyCrm8V1rP93iVPpwaE+gO0SsWmPiXB+jikdf6SizrT5qKasx5j8ABbHpFTx+vFXp9EnYQmLx02h1QTTrl6eDqxLnGjporxl3NL3agEvXdT0WmEost648sQOYAeJS9Q7bfUVoMGnjo4AZdUMQku50McDcMWcBPvr0SzbTAFDfvJqwLzgxwATnCgnp4wDl6Aa+Ax283gghmj+vj7feE2KBBRMW3FzOpLOADl0Isb5587h/U4gGvkt5v60Z1VLG8BhYjbzRwyQZemwAd6cCR5/XFWLYZRIMpX39AR0tjaGGiGzLVyhse5C9RKC6ai42ppWPKiBagOvaYk8lO7DajerabOZP46Lby5wKjw1HCRx7p9sVMOWGzb/vA1hwiWc6jm3MvQDTogQkiqIhJV0nBQBTU+3okKCFDy9WwferkHjtxib7t3xIUQtHxnIwtx4mpg26/HfwVNVDb4oI9RHmx5WGelRVlrtiw43zboCLaxv46AZeB3IlTkwouebTr1y2NjSpHz68WNFjHvupy3q8TFn3Hos2IAk4Ju5dCo8B3wP7VPr/FGaKiG+T+v+TQqIrOqMTL1VdWV1DdmcbO8KXBz6esmYWYKPwDL5b5FA1a0hwapHiom0r/cKaoqr+27/XcrS5UwSMbQAAAABJRU5ErkJggg==" alt="DeepWiki"></a>
    <!-- DeepWiki badge generated by https://deepwiki.ryoppippi.com/ -->
</p>

A powerful wrapper for [gemini-cli](https://github.com/google-gemini/gemini-cli) that provides detailed token usage tracking and cost analysis using OpenTelemetry data.

Normally you would use `gemini` commands, but **logs aren't saved at all**. Use `bunx gemistat` instead to automatically capture conversation logs and detailed telemetry data with OpenTelemetry, enabling token tracking and cost analytics.

## Features

- ğŸ¯ **Accurate Token Tracking** - Uses gemini-cli's native OpenTelemetry system for 100% precision
- ğŸ’° **Real-time Cost Analysis** - Fetches latest pricing from LiteLLM's comprehensive model database
- ğŸ“Š **Multiple Report Types** - Daily, monthly aggregations with detailed breakdowns
- ğŸ” **Date Range Filtering** - Analyze usage for specific time periods
- ğŸ“± **Smart Responsive Tables** - Automatically adapts to terminal width with compact mode
- ğŸ“„ **JSON Export** - Machine-readable output for integration with other tools
- ğŸŒ **Offline Mode** - Use pre-cached pricing data when network is unavailable
- ğŸ¨ **Beautiful Output** - Colorful, well-formatted tables for easy reading
- âš¡ **Fast Processing** - Efficiently handles large telemetry files with streaming parsing

## Installation

### Quick Start (Recommended)

You can run gemistat directly without installation:

```bash
# Using bunx (recommended for speed)
bunx gemistat

# Using npx
npx gemistat@latest

# Using pnpm
pnpm dlx gemistat
```

> ğŸ’¡ **Tip**: We recommend using `bunx` instead of `npx` for a massive speed improvement!

### Prerequisites

- [gemini-cli](https://github.com/google-gemini/gemini-cli) installed and configured with API key

#### Installing gemini-cli

```bash
# Install gemini-cli globally
npm install -g @google/generative-ai-cli

# Configure with your API key
gemini config set apiKey YOUR_API_KEY
```

For detailed setup instructions, see the [gemini-cli documentation](https://github.com/google-gemini/gemini-cli#installation).

## Usage

### Basic Commands

```bash
# Wrapper mode (default) - run gemini-cli with telemetry
bunx gemistat [gemini-cli-options]
bunx gemistat chat
bunx gemistat --model gemini-2.0-flash-exp
bunx gemistat -p "hello how are you"

# Daily usage report
bunx gemistat daily

# Monthly usage report
bunx gemistat monthly
```

### Advanced Usage

```bash
# Daily reports with filtering
bunx gemistat daily --since 2024-01-01 --until 2024-01-31
bunx gemistat daily --json                 # JSON output
bunx gemistat daily --compact              # Force compact tables
bunx gemistat daily --offline              # Use cached pricing

# Monthly aggregations
bunx gemistat monthly --since 2024-01 --until 2024-03
bunx gemistat monthly --json

# Custom data directory
bunx gemistat daily --dir /path/to/telemetry/files
```

> ğŸ’¡ **More Options**: Since gemistat shares similar options with ccusage, please refer to [ccusage.com](https://ccusage.com/) for detailed command-line options and advanced usage patterns.

### Example Output

#### Daily Report

```
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚                               â”‚
 â”‚  Gemini Usage Report - Daily  â”‚
 â”‚                               â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Date     â”‚ Models        â”‚    Input â”‚   Output â”‚       Cache â”‚     Cache â”‚       Total â”‚      Cost â”‚
â”‚          â”‚               â”‚          â”‚          â”‚      Create â”‚      Read â”‚      Tokens â”‚     (USD) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2025-08â€¦ â”‚ -             â”‚    6,319 â”‚       10 â”‚           0 â”‚         0 â”‚       6,329 â”‚     $0.01 â”‚
â”‚          â”‚ gemini-2.5-pâ€¦ â”‚          â”‚          â”‚             â”‚           â”‚             â”‚           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total    â”‚               â”‚    6,319 â”‚       10 â”‚           0 â”‚         0 â”‚       6,329 â”‚     $0.01 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Configuration

### Environment Variables

Customize telemetry file locations:

```bash
# Default configuration
~/.gemini/usage/YYYY-MM-DD_gemini-telemetry.jsonl

# Custom directory
GEMISTAT_OUTPUT_DIR=/tmp/gemini-logs ./index.ts chat

# Custom filename
GEMISTAT_TELEMETRY_FILE=my-usage.jsonl ./index.ts chat

# Combined custom settings
GEMISTAT_OUTPUT_DIR=/tmp/logs GEMISTAT_TELEMETRY_FILE=usage.jsonl ./index.ts chat
```

### Output Files

- `YYYY-MM-DD_gemini-telemetry.jsonl` - Raw OpenTelemetry events (auto-generated, date-prefixed)
- Files are saved to `~/.gemini/usage/` by default

## How It Works

gemistat works by leveraging gemini-cli's built-in OpenTelemetry support to capture detailed usage metrics.

### Why OpenTelemetry?

Regular gemini-cli logs don't contain token usage information, making it impossible to track consumption or calculate costs. gemistat solves this by enabling OpenTelemetry, which captures detailed token metrics for each API call including input tokens, output tokens, cached tokens, and more.

These OpenTelemetry events are then combined with the latest token pricing data from LiteLLM to calculate accurate costs. This allows gemistat to provide comprehensive usage analytics and cost tracking that wouldn't be possible with standard gemini-cli logs alone.

### The Process

### 1. Telemetry Capture

```bash
# gemistat automatically adds these flags to gemini-cli
gemini chat --telemetry --telemetry-target=local --telemetry-outfile=~/.gemini/usage/YYYY-MM-DD_gemini-telemetry.jsonl
```

### 2. OpenTelemetry Event Processing

The telemetry file contains structured events like:

```json
{
	"attributes": {
		"event.name": "gemini_cli.api_response",
		"event.timestamp": "2024-01-15T14:30:45.123Z",
		"model": "gemini-1.5-pro",
		"input_token_count": 2100,
		"output_token_count": 856,
		"cached_content_token_count": 450,
		"thoughts_token_count": 0,
		"tool_token_count": 25
	}
}
```

### 3. Data Aggregation & Cost Calculation

- Events are parsed and validated using Zod schemas
- Token usage is aggregated by date/month
- Costs are calculated using LiteLLM's live pricing database
- Cache tokens, thoughts tokens, and tool tokens are tracked separately

For detailed information about gemini-cli's telemetry system, see the [official telemetry documentation](https://github.com/google-gemini/gemini-cli/blob/main/docs/telemetry.md).

## Troubleshooting

### Common Issues

**No usage data found**

```bash
# Ensure gemini-cli is working first
gemini --version

# Check if telemetry files exist
ls ~/.gemini/usage/

# Try running with explicit directory
bunx gemistat daily --dir ~/.gemini/usage
```

## Development

### Running the Project

```bash
# Type checking
bun run typecheck

# Linting and formatting
bun run lint
bun run format

# Running tests
bun run test

# Build for distribution
bun run build
```

### Project Structure

```
src/
â”œâ”€â”€ commands/           # CLI command implementations
â”‚   â”œâ”€â”€ daily.ts       # Daily usage reports
â”‚   â”œâ”€â”€ monthly.ts     # Monthly usage reports
â”‚   â””â”€â”€ wrapper.ts     # Gemini CLI wrapper
â”œâ”€â”€ _schemas.ts        # Zod validation schemas
â”œâ”€â”€ _table.ts          # Table formatting utilities
â”œâ”€â”€ data-loader.ts     # Telemetry data processing
â”œâ”€â”€ telemetry-parser.ts # OpenTelemetry event parsing
â”œâ”€â”€ pricing.ts         # LiteLLM cost calculations
â””â”€â”€ logger.ts          # Logging utilities
```

## Sponsors

<p align="center">
    <a href="https://github.com/sponsors/ryoppippi">
        <img src="https://cdn.jsdelivr.net/gh/ryoppippi/sponsors@main/sponsors.svg">
    </a>
</p>

## Star History

<a href="https://www.star-history.com/#ryoppippi/gemistat&Date">
    <picture>
        <source media="(prefers-color-scheme: dark)" srcset="https://api.star-history.com/svg?repos=ryoppippi/gemistat&type=Date&theme=dark" />
        <source media="(prefers-color-scheme: light)" srcset="https://api.star-history.com/svg?repos=ryoppippi/gemistat&type=Date" />
        <img alt="Star History Chart" src="https://api.star-history.com/svg?repos=ryoppippi/gemistat&type=Date" />
    </picture>
</a>

## License

[MIT](LICENSE) Â© [@ryoppippi](https://github.com/ryoppippi)

## Credits

- Built for [gemini-cli](https://github.com/google-gemini/gemini-cli) by Google
- Pricing data from [LiteLLM](https://github.com/BerriAI/litellm)
- Inspired by [ccusage](https://github.com/ryoppippi/ccusage)
- OpenTelemetry integration based on [gemini-cli telemetry docs](https://github.com/google-gemini/gemini-cli/blob/main/docs/telemetry.md)
